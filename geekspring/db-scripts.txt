CREATE USER 'geek'@'localhost' IDENTIFIED BY 'geek';
GRANT ALL PRIVILEGES ON * . * TO 'geek'@'localhost';
---
CREATE DATABASE IF NOT EXISTS geek_db;
---
DROP TABLE IF EXISTS students;
CREATE TABLE students (
	id int(11) NOT NULL AUTO_INCREMENT,
    name VARCHAR(100) DEFAULT NULL,
    PRIMARY KEY(id)
) ENGINE=InnoDB CHARSET=latin1;
---
DROP TABLE IF EXISTS courses;
CREATE TABLE courses (
	id int(11) NOT NULL AUTO_INCREMENT,
    title VARCHAR(100) DEFAULT NULL,
    PRIMARY KEY(id)
) ENGINE=InnoDB CHARSET=latin1;
---
DROP TABLE IF EXISTS students_courses;
CREATE TABLE students_courses (
	student_id int(11) NOT NULL,
    course_id int(11) NOT NULL,

    PRIMARY KEY (student_id, course_id),

    CONSTRAINT FK_STUDENT FOREIGN KEY (student_id)
    REFERENCES students (id)
    ON DELETE NO ACTION ON UPDATE NO ACTION,

    CONSTRAINT FK_COURSE FOREIGN KEY (course_id)
    REFERENCES courses (id)
    ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB CHARSET=latin1;


DROP TABLE IF EXISTS books;
CREATE TABLE books (
	id int(11) NOT NULL AUTO_INCREMENT,
    title VARCHAR(100) DEFAULT NULL,
    year VARCHAR(5) DEFAULT NULL,
    description VARCHAR(100) DEFAULT NULL,
    price double  DEFAULT NULL,
    PRIMARY KEY(id)
) ENGINE=InnoDB;


DROP TABLE IF EXISTS users;
CREATE TABLE users (
	id int(11) NOT NULL AUTO_INCREMENT,
    login VARCHAR(100) DEFAULT NULL,
    password VARCHAR(100) DEFAULT NULL,
    role VARCHAR(100) DEFAULT USER NOT NULL,
    activity tinyint(1) DEFAULT 1 NOT NULL,
    PRIMARY KEY(id)
) ENGINE=InnoDB;
DROP TABLE IF EXISTS users_roles;
CREATE TABLE users_roles (
	id int(11) NOT NULL AUTO_INCREMENT,
    user_id int(11) DEFAULT NOT NULL,
    role_id int(11) DEFAULT NOTNULL,

    CONSTRAINT fk_user FOREIGN KEY (user_id)
        REFERENCES users (id)
        ON DELETE NO ACTION ON UPDATE NO ACTION,
        CONSTRAINT fk_role FOREIGN KEY (role_id)
        REFERENCES roles (id)
        ON DELETE NO ACTION ON UPDATE NO ACTION

    PRIMARY KEY(id)
) ENGINE=InnoDB;

DROP TABLE IF EXISTS roles;
CREATE TABLE roles (
	id int(11) NOT NULL AUTO_INCREMENT ,
    user_id int(11) NOT NULL,
 role_id int(11) NOT NULL,
 PRIMARY KEY(id)
) ENGINE=InnoDB CHARSET=latin1;











---
DROP TABLE IF EXISTS authors;
CREATE TABLE authors (
	id int(11) NOT NULL AUTO_INCREMENT,
    name VARCHAR(80) DEFAULT NULL,
    PRIMARY KEY(id)
) ENGINE=InnoDB CHARSET=latin1;
---
DROP TABLE IF EXISTS books;
CREATE TABLE books (
	id int(11) NOT NULL AUTO_INCREMENT,
    title VARCHAR(100) DEFAULT NULL,
    author_id int(11) DEFAULT NULL,
    PRIMARY KEY(id),
    CONSTRAINT FK_AUTH_ID FOREIGN KEY (author_id)
    REFERENCES authors (id)
) ENGINE=InnoDB CHARSET=latin1;
---
DROP TABLE IF EXISTS readers;
CREATE TABLE readers (
	id int(11) NOT NULL AUTO_INCREMENT,
    name VARCHAR(80) DEFAULT NULL,
    PRIMARY KEY(id)
) ENGINE=InnoDB CHARSET=latin1;
---
CREATE TABLE books_readers (
	book_id int(11) NOT NULL,
    reader_id int(11) NOT NULL,

    PRIMARY KEY (book_id, reader_id),

    CONSTRAINT FK_BOOK FOREIGN KEY (book_id)
    REFERENCES books (id)
    ON DELETE NO ACTION ON UPDATE NO ACTION,

    CONSTRAINT FK_READER FOREIGN KEY (reader_id)
    REFERENCES readers (id)
    ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB CHARSET=latin1;